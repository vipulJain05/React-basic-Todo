name: Manual-cypress

on:
  workflow_dispatch:
    inputs:
      cluster_to_deploy:
        description: "Choose cluster to deploy to"
        required: true
        default: "test"
      tags:
        description: 'Run Cypress Test'
        required: false 
        type: boolean
        default: true
jobs:

  test:
    name: cypress-run
    # run: echo "${{ github.event.inputs.tags }}"
    if: ${{ github.event.inputs.tags}}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        # count can be increased once we increase tests
        # e.g. [1,2,3]
        containers: [1,2,3,4]
    steps:
      - name: Set time
        run: |
          echo "${{ github.event.inputs.tags }}"

      - name: Create file status_job01.txt and write the job status into it
        if: always()
        run: |
          echo ${{ job.status }} > status_job01.txt

      - name: Upload file status_job01.txt as an artifact
        if: always()
        uses: actions/upload-artifact@v1
        with:
          name: pass_status_job01
          path: status_job01.txt

  build:
    # if: ${{ github.event.label.name == 'cypress test ready' }} || ${{github.event.pull_request}}
    runs-on: ubuntu-latest
    # needs: [test]
    if: success()
    name: Job 03
    steps:
      - name: Download artifact pass_status_job01
        uses: actions/download-artifact@v1
        with:
          name: pass_status_job01

      - name: Set the statuses of Job 01 and Job 02 as output parameters
        id: set_outputs
        run: |
          echo "::set-output name=status_job01::$(<pass_status_job01/status_job01.txt)"

      - name: Show the values of the outputs
        run: |
          # using the syntax steps.<step_id>.outputs.<output_name> to access the output parameters
          echo "status_job01 = ${{ steps.set_outputs.outputs.status_job01 }}"
    
